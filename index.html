<script>
// ===== DOM =====
const p1 = document.getElementById("p1");
const p2 = document.getElementById("p2");
const d1 = document.getElementById("d1");
const d2 = document.getElementById("d2");
const name1Input = document.getElementById("name1");
const name2Input = document.getElementById("name2");
const card = document.getElementById("card");
const cardText = document.getElementById("cardText");
const logDiv = document.getElementById("log");

// ===== KONSTANTER =====
const JAIL_TILE = 14;

// ===== BRETT =====
const tiles = [
  {x:90,y:90,type:"lust"}, {x:200,y:90,type:"drink",amount:2}, {x:310,y:90,type:"nothing"}, {x:420,y:90,type:"dare"},
  {x:530,y:90,type:"back",amount:2}, {x:640,y:90,type:"drink",amount:3}, {x:750,y:90,type:"lust"}, {x:860,y:90,type:"go_jail"},
  {x:860,y:200,type:"nothing"}, {x:860,y:310,type:"drink",amount:2}, {x:860,y:420,type:"dare"}, {x:860,y:530,type:"back",amount:2},
  {x:750,y:530,type:"nothing"}, {x:640,y:530,type:"drink",amount:1}, {x:530,y:530,type:"dare"}, {x:420,y:530,type:"nothing"},
  {x:310,y:530,type:"drink",amount:2}, {x:200,y:530,type:"nothing"}, {x:90,y:530,type:"dare"}, {x:20,y:530,type:"lust"},
  {x:20,y:420,type:"dare"}, {x:20,y:310,type:"nothing"}, {x:20,y:200,type:"drink",amount:2}, {x:20,y:90,type:"start"}
];

// ===== KORT =====
const lustCards = [
  "Kyss partneren i 20 sekunder","Mass√©r l√•rene i 1 minutt","Hvisk noe skittent",
  "Gjett favoritt reisem√•l ‚Äì feil: drikk 2 slurker","Stryk hendene p√• et valgfritt sted p√• partner i 30 sek",
  "Si favoritt sexstilling","F√• et kyss et sted du velger","Velg hvem som tar av et plagg",
  "Klin i 30 sek ‚Äì ta av partner 1 plagg","Fortell hvor du √∏nsker √• ha sex",
  "Hva var mest attraktivt ved f√∏rste m√∏te?","Stirr i √∏ynene 30 sek mens du koser l√•ret",
  "Fortell favorittegenskaper","Kyss halsen i 30 sek","Nevn 2 ting som tenner deg","Sitt i fanget til partner √©n runde"
];

const dareCards = [
  "Ta av ett plagg","Drikk 3 slurker","La partneren velge neste kort",
  "Slikk partner et sted du √∏nsker","Tease i 40 sek ‚Äì partner drikker 3 slurker",
  "Stimuler partner nedentil i 30 sek","Gi en lap dance i 40 sek",
  "Hvis naken: valgfri stilling i 3 min ‚Äì ellers 5 slurker",
  "Bind for √∏ynene ‚Äì partner overrasker i 1 min","Ta av 3 plagg og ta 2 slurker"
];

// ===== SPILLERE =====
let players = [
  {pos:0, el:p1, name:"Spiller 1", jailed:false},
  {pos:0, el:p2, name:"Spiller 2", jailed:false}
];

let current = 0;
let locked = false;

// ===== FUNKSJONER =====
function rand(n){ return Math.floor(Math.random()*n)+1; }
function draw(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function log(msg){
  logDiv.innerHTML = `<p>${msg}</p>` + logDiv.innerHTML;
}

function place(p){
  const t = tiles[p.pos];
  p.el.style.left = t.x + "px";
  p.el.style.top = t.y + "px";
}

function roll(){
  if(locked) return;
  locked = true;

  players[0].name = name1Input.value || "Spiller 1";
  players[1].name = name2Input.value || "Spiller 2";

  const p = players[current];

  if(p.jailed){
    log(`${p.name} er i fengsel og mister denne runden üöì`);
    p.jailed = false;
    endTurn();
    return;
  }

  const a = rand(6), b = rand(6);
  d1.textContent = a;
  d2.textContent = b;

  log(`${p.name} kastet ${a + b}`);
  move(a + b);
}

function move(steps){
  const p = players[current];
  let i = 0;

  const anim = setInterval(()=>{
    p.pos = (p.pos + 1) % tiles.length;
    place(p);
    i++;

    if(i >= steps){
      clearInterval(anim);
      resolve(tiles[p.pos]);
    }
  },300);
}

function resolve(tile){
  const p = players[current];

  if(tile.type === "lust"){
    showCard("‚≠ê Lust", draw(lustCards));
  }
  else if(tile.type === "dare"){
    showCard("üî• Dare", draw(dareCards));
  }
  else if(tile.type === "drink"){
    showCard("üç∫ Drikk", `Ta ${tile.amount} slurker`);
  }
  else if(tile.type === "back"){
    showCard("‚¨Ö Tilbake", `G√• ${tile.amount} ruter tilbake`);
    p.pos = (p.pos - tile.amount + tiles.length) % tiles.length;
    place(p);
  }
  else if(tile.type === "go_jail"){
    p.pos = JAIL_TILE;
    p.jailed = true;
    place(p);
    showCard("üöì Fengsel","Du sendes til fengsel (rute 14) og mister neste tur!");
  }
  else{
    endTurn();
  }
}

function showCard(title,text){
  cardText.innerHTML = `<h2>${title}</h2><p>${text}</p>`;
  card.style.display = "flex";
}

function closeCard(){
  card.style.display = "none";
  endTurn();
}

function endTurn(){
  current = (current + 1) % players.length;
  locked = false;
  log(`‚û°Ô∏è ${players[current].name} sin tur`);
}

// ===== START =====
players.forEach(place);
log("üé≤ Spillet er klart!");
</script>
